import {
  BEASTS_OF_CHAOS,
  BIG_WAAAGH,
  BONESPLITTERZ,
  CHAOS_GRAND_ALLIANCE,
  CITIES_OF_SIGMAR,
  DAUGHTERS_OF_KHAINE,
  DEATH_GRAND_ALLIANCE,
  DESTRUCTION_GRAND_ALLIANCE,
  DISPOSSESSED,
  FLESH_EATER_COURTS,
  FYRESLAYERS,
  GLOOMSPITE_GITZ,
  GRAND_HOST_OF_NAGASH,
  GREENSKINZ,
  IDONETH_DEEPKIN,
  IRONJAWZ,
  KHARADRON_OVERLORDS,
  KHORNE,
  LEGION_OF_BLOOD,
  LEGION_OF_CHAOS_ASCENDANT,
  LEGION_OF_NIGHT,
  LEGION_OF_SACRAMENT,
  LEGIONS_OF_AZGORH,
  LEGIONS_OF_GRIEF,
  LETHISIAN_DEFENDERS,
  MERCENARY_COMPANIES,
  NIGHTHAUNT,
  NURGLE,
  OGOR_MAWTRIBES,
  ORDER_GRAND_ALLIANCE,
  OSSIARCH_BONEREAPERS,
  SERAPHON,
  SKAVEN,
  SLAANESH,
  SLAVES_TO_DARKNESS,
  SOULBLIGHT,
  STORMCAST_ETERNALS,
  SYLVANETH,
  TAMURKHANS_HORDE,
  TOMB_KINGS,
  TZEENTCH,
  WANDERERS,
} from 'meta/factions'
import { TImportParsers, WARSCROLL_BUILDER, AZYR, BATTLESCRIBE, UNKNOWN } from 'types/import'

// Add common typos here
// Warscroll Builder on the left - AoS Reminders on the right
const warscrollTypoMap: TNameMap = {
  'Aetherspheric Endrinds': 'Aetherspheric Endrins',
  'Anointed of Asuryan on Flamespyre Phoenix': 'Anointed on Flamespyre Phoenix',
  'Anointed of Asuryan on Frostheart Phoenix': 'Anointed on Frostheart Phoenix',
  'Arch Sorcerer': 'Arch-Sorcerer',
  'Armor of Silvered Sigmarite': 'Armour of Silvered Sigmarite',
  'Berzerker Lord': 'Berserker Lord (Mortal)',
  'Blade of All Frost': 'Blade of All-Frost',
  'Blade of the All-Frost': 'Blade of All-Frost',
  'Blue Horrors of Tzeentch': 'Horrors of Tzeentch',
  'Bound The Burning Head': 'Bound Burning Head',
  'Bracers of Ember-iron': 'Bracers of Ember Iron',
  'Brand of the Spirit Daemon': 'Brand of the Split Daemon',
  'Brimstone Horrors of Tzeentch': 'Horrors of Tzeentch',
  'Brute Fist': 'BruteFist',
  'Bursting with Power': "Burstin' with Power",
  'Chaos Gorebeast Chariots': 'Gorebeast Chariots',
  'Dabbling in Sorcery': 'Dabblings in Sorcery (Anvilgard Battle Trait)',
  'Dark Wizardy': 'Dark Wizardry (Royalty)',
  'Devoted Desciples': 'Devoted Disciples',
  'Evocators on Dracolines': 'Evocators on Celestial Dracolines',
  'Exalted Deathbringer with Impaling Spear': 'Exalted Deathbringer',
  'Explosize Charge': 'Explosive Charge',
  'Extend Astomatrix': 'Extend Astromatrix',
  'Eyes of the Nine': 'The Eyes of the Nine',
  'Flash of Daemonblood': 'Flask of Daemonblood (Knights of the Empty Throne)',
  'Fusil of Conflaguration': 'Fusil of Conflagration',
  'Great Bray Shaman of Slaanesh': 'Great Bray-Shaman',
  'Great Bray Shaman of Tzeentch': 'Great Bray-Shaman',
  'Great Bray Shaman': 'Great Bray-Shaman',
  'Great-Bray Shaman': 'Great Bray-Shaman',
  'Gristlegore Royal Terrorgheist': 'Royal Terrorgheist',
  'Gristlegore Royal Zombie Dragon': 'Royal Zombie Dragon',
  'Grot Scraplauncher': 'Gnoblar Scraplauncher',
  'Guardian of Souls with Nightmare Lantern': 'Guardian of Souls',
  'Hammers of Aurgury': 'Hammers of Augury',
  'Hellstriders with Claw-spears': 'Hellstriders',
  'Hellstriders with Hellscourges': 'Hellstriders',
  'Horn of Consort': 'Horn of the Consort',
  'Horrible Resilient': 'Horribly Resilient',
  'Katakros, Mortarch of the Necropolis': 'Katakros',
  'Khorghos Khul': 'Korghos Khul',
  'Knights of the Empty Throne Varanguard': 'Varanguard',
  'Lighntning Blast': 'Lightning Blast',
  'Lunestone Talisman': 'Loonstone Talisman',
  'Lynus Ghalmorian on Gryph-Charger': 'Lynus Ghalmorian on Gryph Charger',
  'Magestic Horror': 'Majestic Horror (Royalty)',
  'Mannfred Mortarch of Night': 'Mannfred, Mortarch of Night',
  'Master of Defense': 'Master of Defence (Order)',
  'Morathi High Oracle of Khaine': 'Morathi, High Oracle of Khaine',
  'Orruk Gore Gruntas': 'Orruk Gore-gruntas',
  'Pink Horrors of Tzeentch': 'Horrors of Tzeentch',
  'Secret Eater': 'Secret-eater',
  'Slaves to Darkness Chaos Spawn': 'Chaos Spawn',
  'Slaves to Darkness Daemon Prince': 'Daemon Prince',
  'Spider Rider Skittermob': 'Spider Rider Skitterswarm',
  'Strength of Goodhood': 'Strength of Godhood (Pretenders Host)',
  'Terrorghiest Mantle': 'Terrorgheist Mantle',
  'The Blade of Endless Bloodshed': 'Blade of Endless Bloodshed',
  'The Gorechosen': 'Gorechosen',
  'The Grand Fyrd of Furious Peak': 'The Grand Fyrd of Furios Peak',
  'Tzaangor Enlightened on Disc': 'Tzaangor Enlightened',
  'Vial of the Pure Blood': 'Vial of Pure Blood',
  'Vitrolic Spray': 'Vitriolic Spray (Anvilgard)',
  'Vokmortian, Master of the Bone-tithe': 'Vokmortian',
  'Vulturnos, High King of the Deep': 'Volturnos, High King of the Deep',
  'Warpfire Thrower Weapon Team': 'Warpfire Thrower',
  'Warrior Indomniate': 'Warrior Indominate',
  'Windshief Charm': 'Windthief Charm',
  "Anraheir's Claw": "Anraheirs's Claw",
  "Mastro Vivetti's Maginificent Macroscope": "Mastro Vivetti's Magnificent Macroscope (Greywater Fastness)",
  Ogors: 'Ogor Gluttons',
}

// Azyr on the left - AoS Reminders on the right
const azyrTypoMap: TNameMap = {
  'Bursting with Power': "Burstin' with Power",
  'Chaos Gorebeast Chariots': 'Gorebeast Chariots',
  'DHOM-HAIN': 'Dhom Hain (Enclave)',
  'Druid of the Everspring Circle': 'Druid of the Everspring (Living City)',
  'Greywater Artillery Battery': 'Greywater Artillery Company',
  'Hellstriders with Claw-spears': 'Hellstriders',
  'Hellstriders with Hellscourges': 'Hellstriders',
  'Keen Clawed': 'Keen-clawed',
  'Madcap Shamans': 'Madcap Shaman',
  'Ogors Gluttons': 'Ogor Gluttons',
  'Slaves to Darkness Chaos Spawn': 'Chaos Spawn',
  'Slaves to Darkness Daemon Prince': 'Daemon Prince',
  'The Skyborne Slayers': 'Skyborne Slayers',
}

// Battlescribe on the left - AoS Reminders on the right
const battlescribeTypoMap: TNameMap = {
  'Abhorrant Ghoul King on Terrorgheist': 'Abhorrant Ghoul King on Royal Terrorgheist',
  'Aspiring Deathbringer with Goreaxe and Skullhammer': 'Aspiring Deathbringer',
  'Atherquartz Brooch': 'Aetherquartz Brooch',
  'Aventis Firestrike, Magister of Hammerhal': 'Aventis Firestrike',
  'Bladebringer on Exalted Seeker Chariot': 'Bladebringer, Herald on Exalted Chariot',
  'Bladebringer on Hellflayer': 'Bladebringer, Herald on Hellflayer',
  'Blood River Chalice': 'Blood-river Chalice',
  'Boingrot Bounders': 'Boingrot Bounderz',
  'Celestant-Prime, Hammer of Sigmar': 'Celestant-Prime',
  'Chaos Gorebeast Chariot': 'Gorebeast Chariots',
  'Chaos Gorebeast Chariots': 'Gorebeast Chariots',
  'Chronomatic Cogs': 'Chronomantic Cogs',
  'Cloying Sea Mists': 'Cloying Seas Mists',
  'Corpse Cart with Unholy Lodestone': 'Corpse Cart w/ Unholy Lodestone',
  'DHOM-HAIN': 'Dhom Hain (Enclave)',
  'Epicurean Raiders': 'Epicurean Revellers',
  'Furies (of Khorne)': 'Furies',
  'Geminids of Uhl-Gyish': 'Geminids of Uhl-Gysh',
  'Gigantic Chaos Spawn (of Khorne)': 'Gigantic Chaos Spawn',
  'Guardian of Souls with Mortality Glass': 'Guardian of Souls w/ Mortality Glass',
  'Guardian of Souls with Nightmare Lantern': 'Guardian of Souls',
  'Helblaster Volly Gun': 'Helblaster Volley Gun',
  'Hellflayers of Slaanesh': 'Hellflayer',
  'Hellstriders with Claw-spears': 'Hellstriders',
  'Hellstriders with Hellscourges': 'Hellstriders',
  'Helm of Obsidian': 'Helm of Obsidia',
  'Incandescent Rectices': 'Incandescent Rectrices',
  'Light of Dracothian': 'Light of Dracothion',
  'Mazrall the Butcher, Daemon Prince of Khorne': 'Mazarall the Butcher',
  'Mazrall the Butcher': 'Mazarall the Butcher',
  'Mortek Shied-corps': 'Mortek Shield-Corps',
  'Prosecutor with Celestial Hammers': 'Prosecutors with Celestial Hammers',
  'Prosecutor with Stormcall Javelins': 'Prosecutors with Stormcall Javelins',
  'Reiknor the Grimhailer': 'Reikenor the Grimhailer',
  'Savage Orruks Arrowboys': 'Savage Orruk Arrowboys',
  'Shasdow Warrior': 'Shadow Warriors',
  'Skink Handler': 'Razordon Hunting Pack',
  'Slaves to Darkness Chaos Spawn': 'Chaos Spawn',
  'Slaves to Darkness Daemon Prince': 'Daemon Prince',
  'Sneaky Shufflers': 'Sneaky Snufflers',
  'Staff of Occular Optimisation': 'Staff of Ocular Optimisation',
  'The Beguilling Gem': 'Beguiling Gem (Chaos)',
  'Tzaangor Enlightened on Discs of Tzeentch': 'Tzaangor Enlightened',
  'Vanguard-Raptor with Hurricane Crossbow': 'Vanguard-Raptors with Hurricane Crossbows',
  'Vanguard-Raptor with Longstrike Crossbow': 'Vanguard-Raptors with Longstrike Crossbows',
  'Vokmortian, Master of the Bone-tithe': 'Vokmortian',
  'Vulkite Bezerkers': 'Vulkite Berzerkers',
  'Warp Lighting Storm': 'Warp Lightning Storm',
  'Warrgog Prophet': 'Wurrgog Prophet',
  'Zharrgron Flame Splitter': 'Zharrgron Flame-spitter',
  "Anraheir's Claw": "Anraheirs's Claw",
  "Dracothian's Tail": "Dracothion's Tail",
  "Gattleson's Endless Repeater": "Gattlesson's Endless Repeater (AETHERMATIC WEAPON)",
  "Ironskull'z Boyz": "Ironskull's Boyz",
  "Might 'Eadbutt": "Mighty 'Eadbutt",
  BRIOMIDAR: 'Briomdar (Enclave)',
  Protector: 'Protectors',
  Voxaxe: 'Vosaxe',
}

/**
 * This is where we store unknown values that are expected and inconsequential
 * Such as weapon options for units
 * And we shouldn't bother searching for them in the error checking process
 */
export const ignoredUnknownSelections = [
  'Aethermatic Volley Cannon',
  'Aethermatic Volley Guns',
  'Aethershot Rifles',
  'Ancestral War-axe',
  'Arc Hammer',
  'Axe',
  'Banner Bearer',
  'Barbed Whips and Blade Bucklers',
  'Barbed Whips and Sacrificial Knives',
  'Blood Vulture',
  'Boltstorm Pistol',
  'Boss Gore-hacka and Choppa',
  'Brayhorn',
  'Bringer-of-the-Word',
  'Broadaxes',
  'Celestial Hammer(s)',
  'Chaos Hand',
  'Clanr at Bell-ringer',
  'Clanr at Standard Bearer',
  'Clanrat Bell-ringer',
  'Clanrat Standard Bearer',
  'Clawleader',
  'Clubs',
  'Culling Clubs or Prey Hackers with Iron Fists',
  'Cursed Flail',
  'Cursed Lance',
  'Doom Knight',
  'Dread Falchions',
  'Drill Cannons',
  'Drummers',
  'Ensor celled',
  'Ensorcelled',
  'Grandblade',
  'Grandblades',
  'Grandhammer',
  'Grandhammers',
  'Greatblades',
  'Halberds and Shields',
  'Handaxes & Slingshields',
  'Harpoon Launcher',
  'Heavy Sky Cannon',
  'Hornblower',
  'Icon Bearers',
  'Light Skyhooks',
  'Meteoric Javelins & Star Bucklers',
  'Meteoric Standard',
  'Nadirite Blade and Shield',
  'Noise Maker',
  'Ogor Mawtribes Battleline (Beastclaw Raiders General)',
  'Pair of Brute Choppas',
  'Pairs of Clubs or Blades',
  'Pairs of Handaxes',
  'Pig-iron Choppas',
  'Plague Harbingers',
  'Poleaxes',
  'Runic Iron',
  'Savage Blade(s)',
  'Savage Greatblade',
  'Scythes',
  'Shield & Lance',
  'Shockbolt Bow',
  'Sky Cannon',
  'Skybolt Bow',
  'Spirit Swords',
  'Standard Bearer',
  'Standard Bearers',
  'Starstrike Javelin',
  'Sword',
  'Swords',
  'Tenderiser',
  'Tzaangor Mutant',
  'Vicious Blade & Wicked Cutlass',
  'Warblade & Shield',
  'Warhammer & Shield',
  'Witch Rod',
]

// Azyr helper
export const factionToAllegianceMap = {
  'Clans Eshin': 'Masters of Murder (Eshin)',
  'Clans Moulder': 'Prized Creations (Moulder)',
  'Clans Pestilens': 'Echoes of the Great Plagues (Pestilens)',
  'Clans Skryre': 'Warpstone Sparks (Skryre)',
  'Clans Verminus': 'Mighty Warlords (Verminus)',
}

// If a certain trait maps to a specific unit type, put it here
export const importUnitOptionMap = {
  'Balefire Brazier': 'Corpse Cart w/ Balefire Brazier',
  'Celestial Hammer(s)': 'Prosecutors with Celestial Hammers',
  'Living Whip': 'Keeper of Secrets w/ Living Whip',
  'Ritual Knife or Sinistrous Hand': 'Keeper of Secrets w/ Ritual Knife',
  'Ritual Knife': 'Keeper of Secrets w/ Ritual Knife',
  'Shining Aegis': 'Keeper of Secrets w/ Shining Aegis',
  'Sinistrous Hand': 'Keeper of Secrets w/ Sinistrous Hand',
  'Stormcall Javelins': 'Prosecutors with Stormcall Javelins',
  'Unholy Lodestone': 'Corpse Cart w/ Unholy Lodestone',
}

export const importFactionNameMap = {
  'Beastclaw Raiders': OGOR_MAWTRIBES,
  'Beasts of Chaos': BEASTS_OF_CHAOS,
  'Big Waaagh!': BIG_WAAAGH,
  'Blades of Khorne': KHORNE,
  'Cities of Sigmar': CITIES_OF_SIGMAR,
  'Clans Eshin': SKAVEN,
  'Clans Moulder': SKAVEN,
  'Clans Pestilens': SKAVEN,
  'Clans Skryre': SKAVEN,
  'Clans Verminus': SKAVEN,
  'Darkling Covens': CITIES_OF_SIGMAR,
  'Daughters of Khaine': DAUGHTERS_OF_KHAINE,
  'Disciples of Tzeentch': TZEENTCH,
  'Flesh Eater Courts': FLESH_EATER_COURTS,
  'Flesh-eater Courts': FLESH_EATER_COURTS,
  'Gitmob Grots': GLOOMSPITE_GITZ,
  'Gloomspite Gitz': GLOOMSPITE_GITZ,
  'Grand Host of Nagash': GRAND_HOST_OF_NAGASH,
  'Greyfyrd Lodge': MERCENARY_COMPANIES,
  'Grugg Brothers': MERCENARY_COMPANIES,
  'Hedonites of Slaanesh': SLAANESH,
  'Idoneth Deepkin': IDONETH_DEEPKIN,
  'Kharadron Overlords': KHARADRON_OVERLORDS,
  'Legion of Azgorh': LEGIONS_OF_AZGORH,
  'Legion of Blood': LEGION_OF_BLOOD,
  'Legion of Chaos Ascendant': LEGION_OF_CHAOS_ASCENDANT,
  'Legion of Grief': LEGIONS_OF_GRIEF,
  'Legion of Night': LEGION_OF_NIGHT,
  'Legion of Sacrament': LEGION_OF_SACRAMENT,
  'Lethisian Defenders': LETHISIAN_DEFENDERS,
  'Maggotkin of Nurgle': NURGLE,
  'Mercenaries: Greyfyrd Lodge': MERCENARY_COMPANIES,
  'Mercenaries: Grugg Brothers': MERCENARY_COMPANIES,
  'Mercenaries: Order of the Blood-Drenched Rose': MERCENARY_COMPANIES,
  'Mercenaries: Rampagers': MERCENARY_COMPANIES,
  'Mercenaries: Sons of the Lichemaster': MERCENARY_COMPANIES,
  'Mercenaries: Tenebrous Court': MERCENARY_COMPANIES,
  'Mercenaries: The Blacksmoke Battery': MERCENARY_COMPANIES,
  'Mercenaries: The Gutstuffers': MERCENARY_COMPANIES,
  'Moonclan Grots': GLOOMSPITE_GITZ,
  'Ogor Mawtribes': OGOR_MAWTRIBES,
  'Order of the Blood-Drenched Rose': MERCENARY_COMPANIES,
  'Orruk Warclans': BIG_WAAAGH,
  'Ossiarch Bonereapers': OSSIARCH_BONEREAPERS,
  'Slaves to Darkness': SLAVES_TO_DARKNESS,
  'Sons of the Lichemaster': MERCENARY_COMPANIES,
  'Spiderfang Grots': GLOOMSPITE_GITZ,
  'Stormcast Eternals': STORMCAST_ETERNALS,
  'Tenebrous Court': MERCENARY_COMPANIES,
  'The Blacksmoke Battery': MERCENARY_COMPANIES,
  'The Gutstuffers': MERCENARY_COMPANIES,
  'Tomb Kings (Compendium)': TOMB_KINGS,
  'Tomb Kings': TOMB_KINGS,
  "Mercenaries: Nimyard's Rough-Riders": MERCENARY_COMPANIES,
  "Mercenaries: Skroug's Menagerie": MERCENARY_COMPANIES,
  "Nimyard's Rough-Riders": MERCENARY_COMPANIES,
  "Skroug's Menagerie": MERCENARY_COMPANIES,
  "Tamurkhan's Horde": TAMURKHANS_HORDE,
  Bonesplitterz: BONESPLITTERZ,
  Brayherd: BEASTS_OF_CHAOS,
  Chaos: CHAOS_GRAND_ALLIANCE,
  Death: DEATH_GRAND_ALLIANCE,
  Destruction: DESTRUCTION_GRAND_ALLIANCE,
  Dispossessed: DISPOSSESSED,
  Everchosen: SLAVES_TO_DARKNESS,
  Fyreslayers: FYRESLAYERS,
  Greenskinz: GREENSKINZ,
  Gutbusters: OGOR_MAWTRIBES,
  Ironjawz: IRONJAWZ,
  Khorne: KHORNE,
  Lethisian: LETHISIAN_DEFENDERS,
  Nighthaunt: NIGHTHAUNT,
  Nurgle: NURGLE,
  Order: ORDER_GRAND_ALLIANCE,
  Rampagers: MERCENARY_COMPANIES,
  Seraphon: SERAPHON,
  Skaventide: SKAVEN,
  Slaanesh: SLAANESH,
  Soulblight: SOULBLIGHT,
  Sylvaneth: SYLVANETH,
  Thunderscorn: BEASTS_OF_CHAOS,
  Tzeentch: TZEENTCH,
  Wanderers: WANDERERS,
  Warherds: BEASTS_OF_CHAOS,
}

export type TNameMap = { [key: string]: string }

// A map to help the user when Azyr uses the same name for multiple warscrolls
// eg 'Lord-Arcanum on Celestial Dracoline' is one of a number of units just called 'Lord-Arcanum'
// AoS Reminders on the left - Azyr on the right
// Note that the AoS Reminders version is what it *does* import as. This can be the same as
// the Azyr string, which just means there is a unit exactly called what Azyr lists multiple
// units as, or it can be different, meaning multiple units from Azyr map to one in AoS Reminders
// by a partial match.
export const azyrAmbiguousNamesMap = {
  'Abhorrant Ghoul King': 'Abhorrant Ghoul King',
  'Arachnarok Spider with Flinger': 'Arachnarok Spider',
  'Auric Runefather': 'Auric Runefather',
  'Auric Runesmiter': 'Auric Runesmiter',
  'Auric Runeson': 'Auric Runeson',
  'Bladebringer, Herald on Exalted Chariot': 'Bladebringer',
  'Bloodthirster of Insensate Rage': 'Bloodthirster',
  'Chaos Lord': 'Chaos Lord',
  'Corpse Cart w/ Balefire Brazier': 'Corpse Cart',
  'Eidolon of Mathlann, Aspect of the Sea': 'Eidolon of Mathlann',
  'Grey Seer': 'Grey Seer',
  'Herald of Tzeentch': 'Herald of Tzeentch',
  'Knight of Shrouds': 'Knight of Shrouds',
  'Lord-Arcanum': 'Lord-Arcanum',
  'Lord-Celestant': 'Lord-Celestant',
  'Plague Priest': 'Plague Priest',
  'Prosecutors with Celestial Hammers': 'Prosecutors',
  'Prosecutors with Stormcall Javelins': 'Prosecutors',
  'Vanguard-Raptors with Hurricane Crossbows': 'Vanguard-Raptors',
  'Wight King with Baleful Tomb Blade': 'Wight King',
  Evocators: 'Evocators',
  Loonboss: 'Loonboss',
}

type TParserOptions = {
  [key in TImportParsers]: {
    ambiguousNamesMap: TNameMap
    checkPoorSpacing: boolean
    fileReadError: string
    typoMap: TNameMap
  }
}

export const parserOptions: TParserOptions = {
  [WARSCROLL_BUILDER]: {
    ambiguousNamesMap: {},
    checkPoorSpacing: false,
    fileReadError: `There was a problem reading this file. Please try re-downloading it from ${WARSCROLL_BUILDER}.`,
    typoMap: warscrollTypoMap,
  },
  [AZYR]: {
    ambiguousNamesMap: azyrAmbiguousNamesMap,
    checkPoorSpacing: true,
    fileReadError: `There was a problem reading this file.`,
    typoMap: azyrTypoMap,
  },
  [BATTLESCRIBE]: {
    ambiguousNamesMap: {},
    checkPoorSpacing: false,
    fileReadError: `There was a problem reading this file.`,
    typoMap: battlescribeTypoMap,
  },
  [UNKNOWN]: {
    ambiguousNamesMap: {},
    checkPoorSpacing: false,
    fileReadError: `This file format is not recognized.`,
    typoMap: {},
  },
}
